<!DOCTYPE html>
<html>
<head>
<title>WebGLcraft</title>
</head>

<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in  vec4 vPosition;
in  vec2 vTexCoord;
in float vs_shading;
in vec3 vs_normal;

out vec3 fs_normal;
out float fs_shading;
out vec2 fTexCoord;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;

in mat4 matrix;

void main()
{
	fs_shading = vs_shading;
	fs_normal = mat3(matrix) * vs_normal;
	fTexCoord = vTexCoord;

	switch (gl_VertexID) {
	case 1:
	    fTexCoord.y += 0.0625;
	    break;
	case 2:
		fTexCoord.x += 0.0625;
		fTexCoord.y += 0.0625;
		break;
	case 3:
		fTexCoord.x += 0.0625;
		break;
	}/*
	switch (gl_VertexID) {
	case 1:
	    fTexCoord.y += 0.03;
	    break;
	case 2:
		fTexCoord.x += 0.03;
		fTexCoord.y += 0.03;
		break;
	case 3:
		fTexCoord.x += 0.03;
		break;
	}*/
	/*
	switch (gl_VertexID) {
	case 1:
	    fTexCoord.y += 1.0;
	    break;
	case 2:
		fTexCoord.x += 1.0;
		fTexCoord.y += 1.0;
		break;
	case 3:
		fTexCoord.x += 1.0;
		break;
	}*/

	//gl_Position = projectionMatrix * modelViewMatrix * vPosition;
	gl_Position = projectionMatrix * matrix * vPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es

precision mediump float;

in vec3 fs_normal;
in  vec2 fTexCoord;
in float fs_shading;

out vec4 fragColor;

uniform sampler2D Tex0;
uniform vec3 fs_sunlinght_direction;
uniform vec3 fs_sunlinght_color;

void main()
{
	vec3 fs_moonlinght_direction = -1.0 * fs_sunlinght_direction;
	//vec3 fs_moonlinght_color = vec3(.1, .2, .3) * (1.0 - fs_sunlinght_color[0]);
	vec3 fs_moonlinght_color = vec3(.105882353, .125490196, .308627451) * (1.0 - fs_sunlinght_color[0]);
	//vec3 fs_moonlinght_color = vec3(0.101960784,0.109803922,0.262745098) * (1.0 - fs_sunlinght_color[0]);

	float ambient_value = 0.2;
	//vec3 ambient = ambient_value*fs_sunlinght_color;
	vec3 ambient = ambient_value*(fs_sunlinght_color + fs_moonlinght_color);

	float diffuse_sun_value = max(dot(fs_normal, fs_sunlinght_direction)+0.1, 0.0);
	float diffuse_moon_value = max(dot(fs_normal, fs_moonlinght_direction)+0.1, 0.0);
	diffuse_sun_value = min(1.0, diffuse_sun_value);
	diffuse_moon_value = min(1.0, diffuse_moon_value);
	//vec3 diffuse = diffuse_value*fs_sunlinght_color;
	vec3 diffuse = diffuse_moon_value*fs_moonlinght_color + diffuse_sun_value*fs_sunlinght_color;

	//combine
	vec3 tmp = vec3(texture(Tex0, fTexCoord));
	tmp = tmp * .87 * (ambient + diffuse);
	//tmp = tmp * fs_shading;

	fragColor = vec4(tmp, 1.0);
	//fragColor = texture(Tex0, fTexCoord)*fs_shading;
	//fragColor.w = 1.0;
}
</script>

<script type="text/javascript" src="./lib/InitShaders.js"></script>
<script type="text/javascript" src="./lib/MVnew.js"></script>
<script type="text/javascript" src="./lib/simplexNoise.js"></script>
<script type="text/javascript" src="main.js"></script>

<body>
<canvas id="gl-canvas" width="600" height="600">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
<br>

</body>
</html>
